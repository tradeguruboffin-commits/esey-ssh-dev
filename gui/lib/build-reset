#!/bin/bash
# build-git-auth.sh - Optimized Go binary builder

set -e

SOURCE_FILE="sshx-reset.go"
BINARY_NAME="sshx-reset"

if [ ! -f "$SOURCE_FILE" ]; then
    echo "âŒ Error: $SOURCE_FILE found manually check your directory."
    exit 1
fi

echo "ğŸš€ Building $BINARY_NAME binary..."
echo "ğŸ“¦ Using -ldflags '-s -w' for smaller size"

before=$(stat -c%s "$SOURCE_FILE")

go build -ldflags="-s -w" -o "$BINARY_NAME" "$SOURCE_FILE"

after=$(stat -c%s "$BINARY_NAME")

echo "âœ… Build successful!"
echo "ğŸ“Š $SOURCE_FILE: ${before}B â†’ $BINARY_NAME: ${after}B"

reduction=$(awk "BEGIN {pc=($before-$after)*100/$before; printf \"%.1f\", pc}")

echo "ğŸ’¾ Size: ${reduction}% smaller (Compression via stripping)"
echo "---"
echo "ğŸ‰ $BINARY_NAME binary ready!"
echo "ğŸ’¡ Test: ./$BINARY_NAME"
echo "ğŸ’¡ Move: mv $BINARY_NAME ~/bin/"
