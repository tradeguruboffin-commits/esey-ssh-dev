#!/usr/bin/env bash

set -e

APP_NAME="sshx-gui"
ROOT_DIR="$(cd .. && pwd)"
GUI_DIR="$ROOT_DIR/gui"

echo "ðŸš€ Cleaning old builds..."
rm -rf "$GUI_DIR/build"
rm -rf "$GUI_DIR/dist"
rm -f  "$GUI_DIR/$APP_NAME.spec"

cd "$GUI_DIR"

echo "ðŸ”¨ Building GUI (onedir mode)..."

pyinstaller \
  --noconfirm \
  --onedir \
  --name $APP_NAME \
  --clean \
  --noupx \
  --hidden-import=gi \
  --hidden-import=gi.repository.Gtk \
  --hidden-import=gi.repository.Vte \
  --collect-all gi \
  --add-data "../bin:bin" \
  --add-data "lib:gui/lib" \
  easy-ssh-gui.py

echo "âœ… Build complete!"
echo "ðŸ“¦ Output: gui/dist/$APP_NAME"
